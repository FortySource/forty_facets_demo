<input type="checkbox" id="menu-state"/>
<label for="menu-state" id="menu-toggle">🍔</label>
<div id="filters">
  <%= form_with method: :get do |form| %>
    <%= hidden_field_tag 'search[order]', @search.order.definition.request_value if @search.order %>
    <% title_filter = @search.filter(:title) %>
    <%= form.label :title, "Search for:" %>
    <%= text_field_tag 'search[title]', title_filter.value %>
    <%= form.submit "Search" %>
  <% end %>

  <div class="order">
    sort by:
    <%= @search.order.title if @search.order %>
    <ul>
      <% @search.orders.reject(&:active).each do |order| %>
        <li><%= link_to order.title, order.by.path %></li>
      <% end %>
    </ul>
  </div>

  <% filter = @search.filter(:year) %>
  <div class="facet">
    <div class="filter-title">
      <%= filter.name %>
      <span class="small text-muted">
        <%= "(#{filter.facet.length})" %>
      </span>
    </div>
    <div class="filter-values">
      <ul class="selected">
        <% filter.selected.each do |entity| %>
          <li><%= link_to entity.try(:name) || entity, filter.remove(entity).path %></li>
        <% end %>
      </ul>
      <ul class="selectable">
        <% filter.facet.reject(&:selected).each do |facet_value| %>
          <% entity = facet_value.entity %>
          <li>
            <%= link_to entity.try(:name) || entity, filter.add(entity).path %>
            <span class="count"><%= "(#{facet_value.count})" %></span>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
<%= paginate @movies %>
<div id="results">
  <% @movies.each do |movie| %>
    <div style="background-image: url('<%= "https://picsum.photos/seed/#{movie.id}/200/300" %>')">
      <h3><%= movie.title %></h3>
      <div class="writers">by: <%= movie.writers.map(&:name).join(", ") %></div>
      <div class="actors">featuring: <%= movie.actors.map(&:name).join(", ") %></div>
      <div class="price"><%= movie.price %>$</div>
      <div class="year"><%= movie.year unless movie.year == 0%></div>
    </div>
  <% end %>
</div>
<%= paginate @movies %>
